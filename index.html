<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Excel地图标记工具</title>
    <script type="text/javascript" src="https://api.map.baidu.com/api?v=3.0&ak=lPUDavXluAPbmJFdOzLCYEzDT5IiWTps"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <style>
        #map {
            width: 100%;
            height: 600px;
        }
        .container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .upload-section {
            margin-bottom: 20px;
        }
        .instructions {
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="instructions">
            <h2>使用说明：</h2>
            <p>1. 准备Excel文件，第一列为经度，第二列为纬度，第三列为店名</p>
            <p>2. 点击"选择文件"按钮上传Excel文件</p>
            <p>3. 地图上将显示所有位置点，鼠标悬停可查看店名</p>
        </div>
        <div class="upload-section">
            <input type="file" id="fileInput" accept=".xlsx,.xls">
        </div>
        <div id="map"></div>
    </div>

    <script>
        // 初始化地图
        var map = new BMap.Map("map");
        // 初始化地图中心点（默认北京）
        var point = new BMap.Point(116.404, 39.915);
        map.centerAndZoom(point, 12);
        // 添加地图控件
        map.addControl(new BMap.NavigationControl());
        map.addControl(new BMap.ScaleControl());
        map.enableScrollWheelZoom();

        // 处理文件上传
        document.getElementById('fileInput').addEventListener('change', function(e) {
            var file = e.target.files[0];
            var reader = new FileReader();

            reader.onload = function(e) {
                var data = new Uint8Array(e.target.result);
                var workbook = XLSX.read(data, {type: 'array'});
                var firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                var jsonData = XLSX.utils.sheet_to_json(firstSheet, {header: 1});

                // 清除现有标记
                map.clearOverlays();

                // 创建边界对象用于自适应缩放
                var bounds = new BMap.Bounds();

                // 从第二行开始处理数据（跳过表头）
                for (var i = 1; i < jsonData.length; i++) {
                    var row = jsonData[i];
                    if (row.length >= 3) {
                        var lng = parseFloat(row[0]);
                        var lat = parseFloat(row[1]);
                        var name = row[2];

                        if (!isNaN(lng) && !isNaN(lat)) {
                            var point = new BMap.Point(lng, lat);
                            var marker = new BMap.Marker(point);
                            
                            // 创建信息窗口
                            var label = new BMap.Label(name, {
                                offset: new BMap.Size(20, -10)
                            });
                            label.setStyle({
                                display: "none",
                                border: "1px solid #ccc",
                                padding: "5px",
                                borderRadius: "3px",
                                backgroundColor: "white"
                            });
                            
                            marker.setLabel(label);
                            
                            // 添加鼠标事件
                            marker.addEventListener("mouseover", function() {
                                this.getLabel().setStyle({display: "block"});
                            });
                            marker.addEventListener("mouseout", function() {
                                this.getLabel().setStyle({display: "none"});
                            });

                            map.addOverlay(marker);
                            bounds.extend(point);
                        }
                    }
                }

                // 调整地图视野
                if (!bounds.isEmpty()) {
                    map.setViewport(bounds);
                }
            };

            reader.readAsArrayBuffer(file);
        });
    </script>
</body>
</html> 